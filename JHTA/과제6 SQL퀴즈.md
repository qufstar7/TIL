# SQL 퀴즈
* SELECT
* 단일행함수
* 그룹함수
* 조인
* 서브쿼리
```SQL
-- 모든 직원의 아이디, 이름, 부서번호, 부서명을 조회하기(부서아이디가 NULL인 직원제외)
SELECT E.EMPLOYEE_ID, E.FIRST_NAME, E.DEPARTMENT_ID, D.DEPARTMENT_NAME 
FROM EMPLOYEES E, DEPARTMENTS D
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND D.DEPARTMENT_ID IS NOT NULL;

-- 커미션을 받는 직원들의 아이디, 이름, 부서번호, 부서명, 급여등급을 조회하기
SELECT E.EMPLOYEE_ID, E.FIRST_NAME, E.DEPARTMENT_ID, D.DEPARTMENT_NAME, S.GRADE
FROM EMPLOYEES E, DEPARTMENTS D, SALARY_GRADE S
WHERE E.SALARY >= S.MIN_SALARY AND E.SALARY <= S.MAX_SALARY
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND E.COMMISSION_PCT IS NOT NULL;

-- 모든 직원의 직원아이디, 이름, 그 직원의 상사이름, 소속부서이름, 소속부서 관리자 이름 조회하기
SELECT E.EMPLOYEE_ID, E.FIRST_NAME EMP, M.FIRST_NAME MGR, D.DEPARTMENT_NAME, D.MANAGER_ID
FROM EMPLOYEES E, DEPARTMENTS D, EMPLOYEES M
WHERE E.MANAGER_ID = M.EMPLOYEE_ID
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID;

-- 80번 부서의 평균급여, 최저급여, 최고급여를 조회하기
SELECT TRUNC(AVG(SALARY)), MIN(SALARY), MAX(SALARY)
FROM EMPLOYEES
WHERE DEPARTMENT_ID = '80';

-- 각 부서별 최저급여와 최고급여, 그 둘 사이의 차이를 조회하기
SELECT DEPARTMENT_ID, MIN(SALARY), MAX(SALARY), MAX(SALARY) - MIN(SALARY) GAP
FROM EMPLOYEES
WHERE DEPARTMENT_ID IS NOT NULL
GROUP BY DEPARTMENT_ID
ORDER BY DEPARTMENT_ID;

-- 100번 직원에게 보고하는 직원이 몇명인지 조회하기
SELECT COUNT(*) 
FROM EMPLOYEES
WHERE MANAGER_ID = '100';

-- 부서별 최고급여를 조회했을 때 최고급여가 15000을 넘는 부서의 아이디와 최고급여를 조회하기
SELECT DEPARTMENT_ID, MAX(SALARY)
FROM EMPLOYEES
WHERE DEPARTMENT_ID IS NOT NULL
GROUP BY DEPARTMENT_ID
HAVING MAX(SALARY) > 15000;

-- 직종별로 종사하는 직원수를 조회하고, 직원수로 오름차순 정렬해서 조회하기
SELECT JOB_ID, COUNT(*)
FROM EMPLOYEES
GROUP BY JOB_ID
ORDER BY COUNT(*);

-- first_name이 'Neena'인 직원보다 보다 많은 급여를 받는 직원의 아이디, 이름, 급여를 조회하기
SELECT EMPLOYEE_ID, FIRST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY > (SELECT SALARY
                FROM EMPLOYEES
                WHERE FIRST_NAME = 'Neena');

-- 200번 직원과 같은 부서에서 근무하는 직원의 아이디, 이름, 급여를 조회하기
SELECT EMPLOYEE_ID, FIRST_NAME, SALARY
FROM EMPLOYEES
WHERE DEPARTMENT_ID IN (SELECT DEPARTMENT_ID
                        FROM EMPLOYEES
                        WHERE EMPLOYEE_ID = '200');

-- 직종별 평균급여를 계산했을 때 평균급여가 가장 적은 직종과 평균급여를 조회하기
WITH JOB_AVG
AS (SELECT JOB_ID, TRUNC(AVG(SALARY)) AVG_SAL
    FROM EMPLOYEES
    GROUP BY JOB_ID)
SELECT JOB_ID, AVG_SAL
FROM JOB_AVG
WHERE AVG_SAL = (SELECT MIN(AVG_SAL)
                 FROM JOB_AVG);

-- 직종별 평균급여를 계산했을 때 평균급여가 가장 적은 직종의 아이디, 직종제목, 그 직종의 최저급여, 그 직종의 최대급여를 조회하기
WITH JOB_AVG
AS (SELECT JOB_ID, TRUNC(AVG(SALARY)) AVG_SAL
    FROM EMPLOYEES
    GROUP BY JOB_ID)
SELECT A.JOB_ID, J.JOB_TITLE, MIN_SALARY, MAX_SALARY
FROM JOB_AVG A, JOBS J
WHERE AVG_SAL = (SELECT MIN(AVG_SAL)
                 FROM JOB_AVG)
AND A.JOB_ID = J.JOB_ID;
                 
-- 급여가 천체 직원의 평균급여보다 많이 받는 직원의 아이디, 이름, 급여를 조회하기
SELECT EMPLOYEE_ID, FIRST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY > (SELECT AVG(SALARY)
                FROM EMPLOYEES)
ORDER BY SALARY;

--  'Neena'와 같은 해에 입사한 직원의 아이디, 이름, 입사일을 조회하기
SELECT EMPLOYEE_ID, FIRST_NAME, HIRE_DATE
FROM EMPLOYEES
WHERE TO_CHAR(HIRE_DATE, 'YYYY') = (SELECT TO_CHAR(HIRE_DATE, 'YYYY')
                                    FROM EMPLOYEES
                                    WHERE FIRST_NAME = 'Neena');

-- 부서별 평균급여를 계산했을 때 Ismael이 근무하는 부서의 평균급여보다 급여를 많이 받는 부서의 아이디와 평균급여를 조회하기
WITH A
AS (SELECT DEPARTMENT_ID, TRUNC(AVG(SALARY)) AVG_SAL
    FROM EMPLOYEES
    WHERE DEPARTMENT_ID IS NOT NULL
    GROUP BY DEPARTMENT_ID
    ORDER BY DEPARTMENT_ID)
SELECT DEPARTMENT_ID, AVG_SAL
FROM A
WHERE AVG_SAL > (SELECT TRUNC(AVG(SALARY))
                 FROM EMPLOYEES
                 WHERE DEPARTMENT_ID = (SELECT DEPARTMENT_ID
                                        FROM EMPLOYEES
                                        WHERE FIRST_NAME = 'Ismael'))
ORDER BY AVG_SAL;

-- 직원 테이블의 급여를 기준으로 급여 등급을 조회했을 때, 급여등급별 직원수를 조회하기
SELECT S.GRADE, COUNT(*)
FROM EMPLOYEES E, SALARY_GRADE S
WHERE E.SALARY >= S.MIN_SALARY AND E.SALARY <= S.MAX_SALARY
GROUP BY S.GRADE;

-- 직원들이 근무하는 부서의 소재도시와 그 도시에서 근무하는 직원수를 조회하기
SELECT L.CITY, COUNT(*) CNT_EMPS
FROM EMPLOYEES E, DEPARTMENTS D, LOCATIONS L
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND D.LOCATION_ID = L.LOCATION_ID
GROUP BY L.CITY;

-- 가장 적은 직원이 입사한 해와 그 해에 입사한 직원수를 조회하기
WITH CNT_YEAR
AS (SELECT TO_CHAR(HIRE_DATE, 'YYYY') HIRE_YEAR , COUNT(*) CNT
    FROM EMPLOYEES
    GROUP BY TO_CHAR(HIRE_DATE, 'YYYY'))
SELECT  HIRE_YEAR, CNT
FROM CNT_YEAR
WHERE CNT = (SELECT MIN(CNT)
             FROM CNT_YEAR);

-- 관리자별 직원수를 조회했을 때 직원수가 10명을 넘는 관리자 아이디와 직원수를 조회하기
WITH A
AS (SELECT E.MANAGER_ID ID, COUNT(*) EMPS
    FROM EMPLOYEES E, EMPLOYEES M
    WHERE E.MANAGER_ID = M.EMPLOYEE_ID
    GROUP BY E.MANAGER_ID)
SELECT ID, EMPS
FROM A
WHERE EMPS > 10;

-- 부서별 평균급여를 조회했을 때 그 부서의 평균급여보다 적은 급여를 받은 직원의 이름, 급여, 부서명을 조회하기 (부서명순으로 정렬하기)
WITH TEMP
AS (SELECT DEPARTMENT_ID DEPT_ID, TRUNC(AVG(SALARY)) AVG_SAL
    FROM EMPLOYEES
    WHERE DEPARTMENT_ID IS NOT NULL
    GROUP BY DEPARTMENT_ID)
SELECT E.FIRST_NAME, E.SALARY, D.DEPARTMENT_NAME
FROM EMPLOYEES E, DEPARTMENTS D, TEMP T
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND T.DEPT_ID = E.DEPARTMENT_ID
AND SALARY < AVG_SAL
ORDER BY D.DEPARTMENT_NAME;

-- employees 테이블에서 직원들의 모든 직종아이디를 조회하기
SELECT JOB_ID
FROM EMPLOYEES
GROUP BY JOB_ID;

-- 급여를 12,000달러 이상 받는 직원의 이름과 급여를 조회하기
SELECT FIRST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY >= 12000;

-- 직원번호가 176번 직원의 아이디와 이름 직종을 조회하기
SELECT E.FIRST_NAME, E.JOB_ID, J.JOB_TITLE
FROM EMPLOYEES E, JOBS J
WHERE E.JOB_ID = J.JOB_ID
AND E.EMPLOYEE_ID = '176';

-- 급여를 12,000달러 이상 15,000달러 이하 받는 직원들의 직원 아이디와 이름과 급여를 조회하기
SELECT EMPLOYEE_ID, FIRST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY >= 12000 AND SALARY <= 15000;

-- 2005년 1월 1일부터 2000년 6월 30일 사이에 입사한 직원의 아이디, 이름, 직종아이디, 입사일을 조회하기
SELECT EMPLOYEE_ID, FIRST_NAME, JOB_ID, HIRE_DATE
FROM EMPLOYEES
WHERE HIRE_DATE >= '2005/01/01' AND HIRE_DATE <= '2006/06/30';

-- 급여가 5,000달러와 12,000달러 사이이고, 부서번호가 20 또는 50인 직원의 이름과 급여를 조회하기
SELECT FIRST_NAME, SALARY
FROM EMPLOYEES
WHERE SALARY >= 5000 AND SALARY <= 12000
AND DEPARTMENT_ID IN (20, 50);

-- 관리자가 없는 직원의 이름과 직종아이디를 조회하기
SELECT FIRST_NAME, JOB_ID
FROM EMPLOYEES
WHERE MANAGER_ID IS NULL;

-- 커미션을 받는 모든 직원의 이름과 급여, 커미션을 조회하고,  급여 및 커미션의 내림차순으로 정렬해서 조회하기
SELECT FIRST_NAME, SALARY, COMMISSION_PCT
FROM EMPLOYEES
WHERE COMMISSION_PCT IS NOT NULL
ORDER BY SALARY, COMMISSION_PCT DESC;

-- 이름의 2번째 글자가 'e'인 모든 직원의 이름을 조회하기
SELECT FIRST_NAME
FROM EMPLOYEES
WHERE SUBSTR(FIRST_NAME, 2, 1) = 'e';

-- 직종아이디가 'ST_CLERK' 또는 'SA_REP'이고 급여를 2500, 3500, 7,000 받는 모든 직원의 이름과 직종아이디, 급여를 조회하기
SELECT FIRST_NAME, JOB_ID, SALARY
FROM EMPLOYEES
WHERE JOB_ID IN ('ST_CLERK', 'SA_REP')
AND SALARY IN ('2500', '3500', '7000');

-- 모든 직원의 이름과 입사일, 근무 개월 수를 계산하여 조회하기, 근무개월 수는 정수로 반올림하고, 근무개월수를 기준으로 오름차순으로 정렬하기
SELECT FIRST_NAME, TO_CHAR(HIRE_DATE, 'YYYY/MM/DD') HIRED, ROUND(MONTHS_BETWEEN(SYSDATE, HIRE_DATE)) MONTHS
FROM EMPLOYEES
ORDER BY MONTHS;

-- 직원의 이름과 커미션을 조회하기, 커미션을 받지 않는 직원은 '없음'으로 표시하기
SELECT FIRST_NAME, NVL(TO_CHAR(COMMISSION_PCT), '없음')
FROM EMPLOYEES;

-- 모든 직원의 이름, 부서번호, 부서이름을 조회하기
SELECT E.FIRST_NAME, E.DEPARTMENT_ID, D.DEPARTMENT_NAME
FROM EMPLOYEES E, DEPARTMENTS D
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID;

-- EMPLOYEES 테이블에서 직원의 이름과 급여를 표시하고, 급여에 대해서 #로 표시하기. '#'하나는 급여 1000에 해당한다.
-- 출력예시
-- 홍길동 4300 ####
-- 김유신 8700 ########
-- 강감찬 6500 ######
SELECT FIRST_NAME, 
    CASE
        WHEN SALARY >= 24000 THEN '########################'
        WHEN SALARY >= 23000 THEN '#######################'
        WHEN SALARY >= 22000 THEN '######################'
        WHEN SALARY >= 21000 THEN '#####################'
        WHEN SALARY >= 20000 THEN '####################'
        WHEN SALARY >= 19000 THEN '###################'
        WHEN SALARY >= 18000 THEN '##################'
        WHEN SALARY >= 17000 THEN '#################'
        WHEN SALARY >= 16000 THEN '################'
        WHEN SALARY >= 15000 THEN '###############'
        WHEN SALARY >= 14000 THEN '##############'
        WHEN SALARY >= 13000 THEN '#############'
        WHEN SALARY >= 12000 THEN '############'
        WHEN SALARY >= 11000 THEN '###########'
        WHEN SALARY >= 10000 THEN '##########'
        WHEN SALARY >= 9000 THEN '#########'
        WHEN SALARY >= 8000 THEN '########'
        WHEN SALARY >= 7000 THEN '#######'
        WHEN SALARY >= 6000 THEN '######'
        WHEN SALARY >= 5000 THEN '#####'
        WHEN SALARY >= 4000 THEN '####'
        WHEN SALARY >= 3000 THEN '###'                               
        WHEN SALARY >= 2000 THEN '##'
        WHEN SALARY >= 1000 THEN '#'
    END AS SAL_AS_#    
FROM EMPLOYEES;

-- EMPLOYEES 테이블에서 2006년 상반기에 입사한 직원들의 직원아이디, 이름, 입사일, 연봉을 계산하기. 연봉은 급여12 + 급여커미션*12다.
SELECT EMPLOYEE_ID, FIRST_NAME, HIRE_DATE, TRUNC(SALARY*12 + NVL(COMMISSION_PCT*12,0)) YEAR_SAL
FROM EMPLOYEES
WHERE TO_CHAR(HIRE_DATE, 'YYYY/MM') >= '2006/01'
AND TO_CHAR(HIRE_DATE, 'YYYY/MM') <= '2006/06';

-- 80번부서에 소속된 직원의 이름과 직종아이디, 직종제목, 부서이름을 조회하기
SELECT E.FIRST_NAME, E.JOB_ID, J.JOB_TITLE, D.DEPARTMENT_NAME
FROM EMPLOYEES E, JOBS J, DEPARTMENTS D
WHERE E.JOB_ID = J.JOB_ID
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND E.DEPARTMENT_ID = '80';

-- 커미션을 받는 모든 직원의 이름과 직종아이디, 직종제목, 부서이름, 부서소재지 도시명을 조회하기
SELECT E.FIRST_NAME, J.JOB_ID, J.JOB_TITLE, D.DEPARTMENT_NAME, L.CITY
FROM EMPLOYEES E, JOBS J, DEPARTMENTS D, LOCATIONS L
WHERE E.JOB_ID = J.JOB_ID
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND D.LOCATION_ID = L.LOCATION_ID
AND E.COMMISSION_PCT IS NOT NULL;

-- 'Europe'에 소재지를 두고 있는 모든 부서아이디와 부서이름을 조회하기
SELECT D.DEPARTMENT_ID, D.DEPARTMENT_NAME
FROM DEPARTMENTS D, REGIONS R, COUNTRIES C, LOCATIONS L
WHERE D.LOCATION_ID = L.LOCATION_ID
AND L.COUNTRY_ID = C.COUNTRY_ID
AND C.REGION_ID = R.REGION_ID
AND R.REGION_NAME = 'Europe';

-- 직원의 이름과 소속부서명, 급여, 급여 등급을 조회하기
SELECT E.FIRST_NAME, D.DEPARTMENT_NAME, E.SALARY, S.GRADE
FROM EMPLOYEES E, DEPARTMENTS D, SALARY_GRADE S
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND E.SALARY >= S.MIN_SALARY AND E.SALARY <= S.MAX_SALARY;

-- 직원의 이름과 소속부서명, 소속부서의 관리자명을 조회하기, 소속부서가 없는 직원은 소속부서명 '없음', 관리자명 '없음'으로 표시하기
SELECT E.FIRST_NAME, NVL(TO_CHAR(D.DEPARTMENT_NAME), '없음'), NVL(TO_CHAR(M.FIRST_NAME), '없음')
FROM EMPLOYEES E, DEPARTMENTS D, EMPLOYEES M
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID (+)
AND E.MANAGER_ID = M.EMPLOYEE_ID (+);

-- 모든 직원의 급여 최고액, 급여 최저액, 급여 총액, 급여 평균액을 조회하기
SELECT MAX(SALARY), MIN(SALARY), SUM(SALARY), TRUNC(AVG(SALARY))
FROM EMPLOYEES;

-- 직종별 급여 최고액, 급여 최저액, 급여 총액, 급여 평균액을 조회하기
SELECT JOB_ID, MAX(SALARY), MIN(SALARY), SUM(SALARY), TRUNC(AVG(SALARY))
FROM EMPLOYEES E
GROUP BY JOB_ID;

-- 각 직종별 직원수를 조회해서 가장 직원수가 많은 직종 3개를 조회하기, 직종아이디와 직원수 표시하기
WITH A
AS (SELECT JOB_ID, COUNT(*) JOB_CNT 
    FROM EMPLOYEES
    GROUP BY JOB_ID
    ORDER BY JOB_CNT DESC)
SELECT JOB_ID, JOB_CNT
FROM A
WHERE ROWNUM <= 3;

-- 관리자별 직원수를 조회하기, 관리자 이름과 그 관리자가 관리하는 직원수 표시하기
SELECT M.FIRST_NAME, COUNT(*)
FROM EMPLOYEES M, EMPLOYEES E
WHERE M.EMPLOYEE_ID = E.MANAGER_ID
GROUP BY M.FIRST_NAME;

-- 각 부서에 대해 부서이름, 관리자 이름, 소속직원 수, 소속직원들의 평균 급여를 조회하기
SELECT D.DEPARTMENT_NAME, M.FIRST_NAME, COUNT(*), TRUNC(AVG(E.SALARY))
FROM EMPLOYEES E, EMPLOYEES M, DEPARTMENTS D
WHERE E.MANAGER_ID = M.EMPLOYEE_ID
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID
GROUP BY D.DEPARTMENT_NAME, M.FIRST_NAME;

-- first_name이 'Steven'인 직원과 같은 부서에 속한 직원의 이름과 입사일을 조회하기
SELECT FIRST_NAME, HIRE_DATE
FROM EMPLOYEES
WHERE DEPARTMENT_ID IN (SELECT DEPARTMENT_ID
                        FROM EMPLOYEES
                        WHERE FIRST_NAME = 'Steven');

-- 소속 부서의 평균급여보다 많은 급여를 받는 직원의 아이디와 직원이름, 급여, 그 부서의 평균 급여를 조회하기
WITH TEMP
AS (SELECT DEPARTMENT_ID, TRUNC(AVG(SALARY)) AVG_SAL
    FROM EMPLOYEES
    GROUP BY DEPARTMENT_ID)
SELECT E.EMPLOYEE_ID, E.FIRST_NAME, E.SALARY, T.AVG_SAL, E.DEPARTMENT_ID
FROM TEMP T, EMPLOYEES E
WHERE E.SALARY >= T.AVG_SAL
AND E.DEPARTMENT_ID = T.DEPARTMENT_ID
ORDER BY DEPARTMENT_ID;

-- last_name이 'Kochhar'과 직원과 동일한 급여를 받는 모든 직원의 이름, 입사일, 급여를 조회하기, 결과에 Kochhar은 포함시키지 않기
SELECT LAST_NAME, HIRE_DATE, SALARY
FROM EMPLOYEES
WHERE SALARY = (SELECT SALARY
                FROM EMPLOYEES
                WHERE LAST_NAME = 'Kochhar')
AND LAST_NAME NOT IN('Kochhar');

-- 소속 부서에 입사일이 늦지만, 더 많은 급여를 받는 직원의 이름과 소속부서명, 급여를 조회하기
SELECT E.FIRST_NAME, D.DEPARTMENT_NAME, E.SALARY
FROM EMPLOYEES E, DEPARTMENTS D, EMPLOYEES E2
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND E.HIRE_DATE > E2.HIRE_DATE
AND E.SALARY > E2.SALARY
GROUP BY E.FIRST_NAME, D.DEPARTMENT_NAME, E.SALARY;

-- 관리자 아이디, 관리자명, 그 관리자가 관리하는 직원수, 그 관리자가 소속된 부서를 조회하기
SELECT M.EMPLOYEE_ID MGR_ID, M.FIRST_NAME MGR, COUNT(*) EMPS, E.DEPARTMENT_ID DEPT
FROM EMPLOYEES E, EMPLOYEES M, DEPARTMENTS D
WHERE E.MANAGER_ID = M.EMPLOYEE_ID
AND E.DEPARTMENT_ID = D.DEPARTMENT_ID
GROUP BY M.EMPLOYEE_ID, M.FIRST_NAME, E.DEPARTMENT_ID;
```